
BOOST_ROOT   = /home/linuxbrew/.linuxbrew/Cellar/boost/1.72.0_2

CXX          = g++-4.9
CXXFLAGS    += -Wall -Wno-unknown-pragmas                         \
                -c -fomit-frame-pointer -std=c++0x -O3            \
               -fno-strict-aliasing -fno-stack-protector          \
               -DBIGARRAY_MULTIPLIER=1 -DUSING_XED                \
               -DTARGET_IA32 -DHOST_IA32 -DTARGET_LINUX -m32 
CXXFLAGS_SO += -Wall -Werror -Wno-unknown-pragmas -D__PIN__=1     \
               -DPIN_CRT=1 -fno-stack-protector -fno-exceptions   \
               -funwind-tables -fasynchronous-unwind-tables       \
               -fno-rtti -DTARGET_IA32E -DHOST_IA32E -fPIC        \
               -DTARGET_LINUX -fabi-version=2
LIBS        += -lpin -lxed -ldwarf -lelf -ldl -lboost_serialization
H_INCLUDE   += -I$(BOOST_ROOT)/include                            \
               -I$(PIN_ROOT)/source/include/pin -I$(PIN_ROOT)/source/include/pin/gen \
               -I$(PIN_ROOT)/source/tools/InstLib
               #-isystem $(PIN_ROOT)/extras/stlport/include \
               -isystem $(PIN_ROOT)/extras/libstdc++/include \
               -isystem $(PIN_ROOT)/extras/crt/include \
               -isystem $(PIN_ROOT)/extras/crt/include/arch-x86_64 \
               -isystem $(PIN_ROOT)/extras/crt/include/kernel/uapi \
               -isystem $(PIN_ROOT)/extras/crt/include/kernel/uapi/asm-x86 \
               -I$(PIN_ROOT)/extras/components/include \
               -I$(PIN_ROOT)/extras/xed-intel64/include/xed 

               #-I$(PIN_HOME)/source/include/pin                   \
               #-I$(PIN_HOME)/source/include/pin/gen               \
               #-I$(PIN_HOME)/extras/xed2-ia32/include             \
               #-I$(PIN_HOME)/extras/components/include
L_INCLUDE   += -L$(BOOST_ROOT)/lib                                \
               -L$(PIN_ROOT)/intel64/runtime/pincrt \
               -L$(PIN_ROOT)/intel64/lib -L$(PIN_ROOT)/intel64/lib-ext \
               -L$(PIN_ROOT)/extras/xed-intel64/lib -lpin -lxed \
               $(PIN_ROOT)/intel64/runtime/pincrt/crtendS.o \
               -lpin3dwarf  -ldl-dynamic -nostdlib -lstlport-dynamic \
               -lm-dynamic -lc-dynamic -lunwind-dynamic
               #-L$(PIN_HOME)/extras/xed2-ia32/lib                 \
               #-L$(PIN_HOME)/ia-32/runtime/cpplibs                \
               #-L$(PIN_HOME)/ia32/lib -L$(PIN_HOME)/ia32/lib-ext

TOOL_ROOTS := track #kernel_module
APP_ROOTS  := track #kernel_module

SRC_SUFFIX := .cpp
SRCDIR     := src/
OBJDIR     := obj/
DISDIR     := dist/

all: track.o

track.o: src/track.cpp
	$(CXX) $(CXXFLAGS) $(H_INCLUDE) -o obj/track.o src/track.cpp

track.so: obj/track.o
	$(CXX) $(CXXFLAGS_SO) $(L_INCLUDE) -o obj/track.so obj/track.o

